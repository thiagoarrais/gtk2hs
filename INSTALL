Gtk2Hs: A binding of Gtk+ Version 2.x for the programming language Haskell

http://gtk2hs.sourceforge.net/

The library currently wraps most functions for GUI programming from
the gtk 2.4 libraries. Furthermore there is support for the Pixbuf
functions, the libglade UI loader, the SourceView widget, the GConf
configuration system, and the Mozilla rendering engine embeded in a widget.

The GHC Haskell compiler, version 5.04 or greater, is required. Some
callback (those with more than 4 words of arguments...) cannot be used
on Solaris due to a limitation in GHC. Gtk2hs has been compiled
successfully on FreeBSD, Linux, Solaris, Darwin and Windows (MinGW).

Building
--------

Check the gtk2hs web page to see if there is a pre-prepared package for your
system. They make everying much easier. If there is not you will need to build
from sources yourself.

If you are building on Windows, read "Building on Windows" first.

The following assumes that the sources are in ~/gtk2hs.
1. Produce a configure file.

~/gtk2hs:$ autoreconf

You may omit this step if you've downloaded the source tarball. If, however,
step 2 fails for no obvious reason you should run autoreconf. (I've seen
ghc-pkg not being found when copying ./configure from FreeBSD, autoconf 2.53
to Solaris, autoconf 2.52.)

2. Run the configure script.

The configure script has several useful options, particularly:

--with-hc=<path to your ghc>
  Uses the specified GHC for compilation and for installation of the package.

--with-hcflags=<path to your ghc>
  If you find that you need to pass any special flags to the Haskell compiler
  then use this option to specify them. This overrides the default flags which
  is just "-O" to compile using optimisations.

--with-c2hs=no
  Uses the c2hs binding tool that comes with gtk2hs. This special version
  works much faster than the normal c2hs from Manuel's website. See
  configure.in for more details. This setting is the default.

--with-c2hs=yes
  Search for a c2hs installation in the current PATH.

NOTE: using an external version of c2hs is not currently working!

--with-c2hs=<path to your c2hs-config>
  Use this specific installation of c2hs. Make sure you specify the c2hs-config
  program, not c2hs itself.

--with-pkgconf=<your pkg.conf file>
  Use a local package.conf file to install the gtk2hs package in. See below.

--without-pkgreg
  This option disables registering the packages in any package.conf file. This
  is useful to people building on one machine but wanting to install on
  another, eg people packaging gtk2hs for use with a package management system.

--disable-libglade
  By default, bindings for the libglade library will be built. If you do not
  have this library installed you will need to use this option.

--disable-gnome
  By default, bindings for some Gnome modules will be built. At the moment
  these are GConf and GtksourceView. If you do not have all these libraries
  installed you will need to use this option.

--disable-mozilla
  By default, bindings for GtkMozEmbed, the Mozilla regnering engine in a
  widget, will be built. You need Mozilla 1.4 or later installed for this,
  othersie you will need to use this option to not build these bindings.

--disable-deprecated
  There are many Gtk+ APIs that have been deprecated as new versions of Gtk+
  have come out. This option makes sure that no deprecated APIs are used. You
  might want to use this option to make sure that you are not using deprecated
  APIs in your new programs.

--enable-docs
  This builds reference documentation in html format. These are also available
  from the website but you may prefer to keep a local copy. You will need
  haddock version 0.6 or later tob build the documentation.

With --help you can ask ./configure what options it supports.

Add any of these options to the following command:

~/gtk2hs:$ ./configure

3. Building the sources.

In the following "make" stands for GNU make. If your system has a program
called "gmake" then make is probably not GNU make. In this case use "gmake".

To build the sources you issue:

~/gtk2hs:$ make

This will build the package "in place" which means all library files
stay in the source tree. If you have used --with-pkgconf=mypkg.conf in
step two, the gtk and other packages will be available through this
file. The default name for this file is localpackage.conf in the root
of the source tree. To use an "in place" installation you say:

ghc --make MyProg.hs -package-conf ~/gtk2hs/localpackage.conf

(If you are using ghc 6.0 or earlier you also need to use -package gtk)

If you are happy with this solution or if you don't have the
privileges to write to the location where GHC lives, you stop here.

4. Install the libraries.

The alternative is to properly install the packages into GHC
itself. In case GHC lives in a privileged place you need to become
root first. To install the library say:

~/gtk2hs:$ make install

Now you can compile your programs simply by saying:

ghc --make MyProg.hs

(If you are using ghc 6.0 or earlier you also need to use -package gtk)

5. Documentation

The documentation is avaliable on the website. You can also build the
documentation locally. You say

~/gtk2hs:$ ./configure --enable-docs

By default the documentation is installed into $(datadir)/doc/gtk2hs/html

Note:

*  So long as you do not delete the source tree if you can easily uninstall
   everything that gtk2hs installed by saying

   ~/gtk2hs:$ make uninstall

   in the root of the source tree. This will properly remove the package from
   GHC and remove any installed file.

   Alteratively, if you do not keep the source tree around then you can
   uninstall by unregistering the packages with ghc-pkg and deleting all the
   isntalled files. Assuming that you installed in the default location
   (ie did not specify --prefix= during ./configure) then that would mean
   doing the following:

   # for pkg in glib gtk mogul glade gconf sourceview mozembed; \
   > do ghc-pkg -r $pkg; done
   # rm -rf /usr/local/lib/gtk2hs/
   # rm -rf /usr/local/share/doc/gtk2hs/  #if you installed the docs

Building on Windows
--------------------

Install MSYS and MinGW.  Download the following files from
http://www.gimp.org/~tml/gimp/win32/downloads.html : atk-1.4.0.zip,
atk-dev-1.4.0.zip, gettext-runtime-0.12.1.bin.woe32.zip,
glib-2.2.3.zip, glib-dev-2.2.3.zip, gtk+-2.2.4.zip,
gtk+-dev-2.2.4.zip, libiconv-1.9.1.bin.woe32.zip, pango-1.2.5.zip,
pango-dev-1.2.5.zip, pkgconfig-0.15.zip. Unpack these files in a
*separate* (1) directory from MinGW. Add the bin/ and the /lib
directory to your path via the Control Panel (or right-clicking My
Computer, Properties, Advanced). Make sure GHC is in your
path. Proceed with the general instructions. If you have the right to
modify the global package file, then I recommend to install the
library into the ghc directory by using configure's --prefix= option.

(1) If you don't use a separate directory, GHC's local gcc might pick
up libraries from MinGW, resulting in link errors or worse.

Please report problems to the Gtk2hs mailing list
<gtk2hs-users@lists.sourceforge.net>.

Have fun,
Axel.
